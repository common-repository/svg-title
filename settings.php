<?php

require_once SVGT_PLUGIN_DIR . '/includes/functions.php';
require_once SVGT_PLUGIN_DIR . '/includes/l10n.php';
require_once SVGT_PLUGIN_DIR . '/includes/svgt-data.php';
require_once SVGT_PLUGIN_DIR . '/includes/svgt-data-functions.php';

if (is_admin()) {
	require_once SVGT_PLUGIN_DIR . '/admin/admin.php';
} else {
	require_once SVGT_PLUGIN_DIR . '/includes/controller.php';
}

class SVGT {

	public static function get_option($name, $default = false) {
		$option = get_option('svgt');

		if ($option === false) {
			return $default;
		}

		if (isset($option[$name])) {
			return $option[$name];
		} else {
			return $default;
		}
	}

	public static function update_option($name, $value) {
		$option = get_option('svgt');
		$option = ($option === false) ? array() : (array) $option;
		$option = array_merge($option, array($name => $value));
		update_option('svgt', $option);
	}
}

add_action('plugins_loaded', 'svgt', 10, 0);

function svgt() {
	svgt_load_textdomain();

	/* Shortcodes */
	add_shortcode('svgt', 'svgt_shortcode_func');
}

add_action('init', 'svgt_init', 10, 0);

function svgt_init() {
	svgt_register_post_types();
}

/* Install and default settings */

add_action('activate_' . SVGT_PLUGIN_BASENAME, 'svgt_install', 10, 0);

function svgt_install() {
	if ($opt = get_option('svgt')) {
		return;
	}

	svgt_load_textdomain();
	svgt_register_post_types();
	if (get_posts(array('post_type' => 'svgt_data'))) {
		return;
	}

	$svgt = SVGT_Data::get_template(
		array(
			'title' =>
				sprintf('SVG Title %d', 1),
		)
	);
	$svgt->set_properties(array('data' => '<svg width="160.04" height="25.064" viewBox="-0.5 -0.5 160.04 25.064" xmlns="http://www.w3.org/2000/svg" id="svgId-10"><g stroke-linecap="round" fill-rule="evenodd" stroke="#000000"><path d="M 48.384 14.208 L 48.384 11.808 L 55.904 11.808 L 55.904 23.68 L 53.216 23.68 L 53.216 21.44 A 11.482 11.482 0 0 1 51.815 22.493 A 15.153 15.153 0 0 1 50.496 23.248 A 7.55 7.55 0 0 1 47.486 24.048 A 9.002 9.002 0 0 1 46.944 24.064 A 8.641 8.641 0 0 1 44.411 23.701 A 7.823 7.823 0 0 1 43.36 23.296 Q 41.728 22.528 40.544 21.088 A 9.946 9.946 0 0 1 39.21 18.943 A 12.422 12.422 0 0 1 38.688 17.616 A 13.08 13.08 0 0 1 38.127 15.028 A 16.924 16.924 0 0 1 38.016 13.056 A 18.266 18.266 0 0 1 38.234 10.179 A 14.721 14.721 0 0 1 38.704 8.144 A 12.145 12.145 0 0 1 39.774 5.659 A 10.326 10.326 0 0 1 40.704 4.304 Q 42.016 2.688 43.92 1.792 Q 45.824 0.896 48.256 0.896 Q 50.297 0.896 51.875 1.374 A 9.095 9.095 0 0 1 51.984 1.408 Q 53.6 1.92 55.04 2.72 L 53.92 5.248 Q 52.576 4.512 51.2 4.032 A 8.462 8.462 0 0 0 49.442 3.631 A 11.023 11.023 0 0 0 48.096 3.552 Q 46.592 3.552 45.312 4.16 A 6.093 6.093 0 0 0 43.192 5.842 A 7.081 7.081 0 0 0 43.104 5.952 A 7.811 7.811 0 0 0 42.187 7.461 A 10.513 10.513 0 0 0 41.648 8.88 A 11.897 11.897 0 0 0 41.236 10.873 A 16.285 16.285 0 0 0 41.12 12.864 A 14.518 14.518 0 0 0 41.233 14.716 A 10.758 10.758 0 0 0 41.6 16.464 Q 42.08 18.048 42.944 19.152 A 5.801 5.801 0 0 0 44.823 20.739 A 5.668 5.668 0 0 0 45.008 20.832 Q 46.208 21.408 47.648 21.408 Q 48.544 21.408 49.344 21.2 Q 50.144 20.992 50.816 20.656 Q 51.488 20.32 52.048 19.92 A 8.576 8.576 0 0 0 52.632 19.465 A 6.775 6.775 0 0 0 53.024 19.104 L 53.024 14.208 L 48.384 14.208 Z M 0 21.792 L 1.536 19.232 Q 2.688 20.192 4.128 20.8 A 7.472 7.472 0 0 0 5.847 21.283 A 10.278 10.278 0 0 0 7.488 21.408 A 8.954 8.954 0 0 0 8.943 21.297 Q 9.718 21.169 10.346 20.894 A 4.384 4.384 0 0 0 11.136 20.448 A 3.29 3.29 0 0 0 12.031 19.518 Q 12.452 18.844 12.478 17.973 A 3.877 3.877 0 0 0 12.48 17.856 A 4.141 4.141 0 0 0 12.397 17.015 A 3.582 3.582 0 0 0 12.288 16.608 Q 12.107 16.066 11.6 15.566 A 4.015 4.015 0 0 0 11.536 15.504 Q 11.129 15.12 10.486 14.737 A 10.766 10.766 0 0 0 9.968 14.448 Q 9.283 14.089 8.324 13.693 A 36.537 36.537 0 0 0 7.36 13.312 A 33.365 33.365 0 0 1 6.138 12.81 Q 5.541 12.55 5.024 12.292 A 17.612 17.612 0 0 1 4.432 11.984 Q 3.232 11.328 2.496 10.544 A 4.894 4.894 0 0 1 1.66 9.348 A 4.46 4.46 0 0 1 1.44 8.816 A 5.868 5.868 0 0 1 1.186 7.702 A 7.957 7.957 0 0 1 1.12 6.656 Q 1.12 5.472 1.616 4.416 A 5.102 5.102 0 0 1 2.909 2.725 A 5.979 5.979 0 0 1 3.088 2.576 A 6.536 6.536 0 0 1 4.405 1.763 A 8.608 8.608 0 0 1 5.488 1.344 A 9.398 9.398 0 0 1 7.114 0.994 A 12.753 12.753 0 0 1 8.736 0.896 A 16.901 16.901 0 0 1 10.56 0.99 A 12.418 12.418 0 0 1 12.288 1.296 Q 13.856 1.696 15.392 2.432 L 14.272 5.024 A 10.079 10.079 0 0 0 12.952 4.378 A 13.34 13.34 0 0 0 11.728 3.952 Q 10.272 3.52 8.672 3.52 A 8.867 8.867 0 0 0 7.382 3.608 Q 6.705 3.708 6.152 3.921 A 4.07 4.07 0 0 0 5.344 4.336 A 3.039 3.039 0 0 0 4.633 4.983 A 2.387 2.387 0 0 0 4.128 6.496 Q 4.128 7.136 4.304 7.632 Q 4.456 8.06 4.87 8.464 A 3.59 3.59 0 0 0 5.008 8.592 A 4.836 4.836 0 0 0 5.457 8.939 Q 5.699 9.105 5.992 9.273 A 11.069 11.069 0 0 0 6.48 9.536 A 15.017 15.017 0 0 0 7.203 9.877 Q 7.583 10.046 8.03 10.224 A 36.948 36.948 0 0 0 8.992 10.592 A 28.502 28.502 0 0 1 10.405 11.169 Q 11.097 11.475 11.684 11.787 A 15.02 15.02 0 0 1 12.128 12.032 A 10.86 10.86 0 0 1 13.117 12.67 Q 13.597 13.021 13.974 13.391 A 6.089 6.089 0 0 1 14.176 13.6 A 5.502 5.502 0 0 1 14.952 14.662 A 4.716 4.716 0 0 1 15.28 15.392 A 5.991 5.991 0 0 1 15.583 16.803 A 7.325 7.325 0 0 1 15.616 17.504 A 6.895 6.895 0 0 1 15.454 19.027 A 5.538 5.538 0 0 1 15.008 20.288 Q 14.4 21.504 13.328 22.352 Q 12.256 23.2 10.752 23.632 A 11.146 11.146 0 0 1 8.563 24.022 A 13.42 13.42 0 0 1 7.488 24.064 Q 5.152 24.064 3.232 23.44 A 12.226 12.226 0 0 1 1.515 22.742 A 9.098 9.098 0 0 1 0 21.792 Z M 25.44 23.68 L 17.216 2.08 L 20.192 0.928 L 27.232 20.352 L 34.304 1.024 L 37.056 2.08 L 28.864 23.68 L 25.44 23.68 Z M 153.12 1.28 L 155.232 1.28 L 155.232 21.12 L 159.04 21.12 L 159.04 23.68 L 147.776 23.68 L 147.776 21.12 L 152.352 21.12 L 152.352 4.96 L 148.064 8.192 L 146.496 6.048 L 153.12 1.28 Z M 67.904 3.968 L 67.904 1.28 L 84.704 1.28 L 84.704 3.968 L 77.824 3.968 L 77.824 23.68 L 74.784 23.68 L 74.784 3.968 L 67.904 3.968 Z M 132.192 16.544 L 120.544 16.544 Q 120.812 18.72 121.997 20.008 A 4.794 4.794 0 0 0 122.176 20.192 A 4.526 4.526 0 0 0 124.616 21.411 A 6.407 6.407 0 0 0 125.728 21.504 Q 127.168 21.504 128.32 21.2 Q 129.472 20.896 130.528 20.416 L 131.2 22.88 A 11.33 11.33 0 0 1 129.658 23.469 A 14.165 14.165 0 0 1 128.608 23.744 A 13.028 13.028 0 0 1 126.979 23.994 A 17.474 17.474 0 0 1 125.376 24.064 A 9.337 9.337 0 0 1 123.521 23.887 A 7.555 7.555 0 0 1 122.144 23.472 Q 120.704 22.88 119.696 21.776 A 7.081 7.081 0 0 1 118.529 20.016 A 8.824 8.824 0 0 1 118.144 19.056 A 10.106 10.106 0 0 1 117.712 17.15 A 13.7 13.7 0 0 1 117.6 15.36 Q 117.6 13.504 118.144 11.904 A 8.864 8.864 0 0 1 119.044 10 A 7.729 7.729 0 0 1 119.68 9.136 Q 120.672 7.968 122.048 7.312 A 6.786 6.786 0 0 1 124.381 6.689 A 8.256 8.256 0 0 1 125.12 6.656 A 8.931 8.931 0 0 1 126.689 6.787 A 6.598 6.598 0 0 1 128.256 7.264 A 6.416 6.416 0 0 1 130.083 8.487 A 6.027 6.027 0 0 1 130.496 8.928 A 7.022 7.022 0 0 1 131.775 11.196 A 8.068 8.068 0 0 1 131.84 11.392 A 9.711 9.711 0 0 1 132.287 14.221 A 10.898 10.898 0 0 1 132.288 14.368 A 24.065 24.065 0 0 1 132.195 16.511 A 22.061 22.061 0 0 1 132.192 16.544 Z M 96.288 7.648 L 96.896 2.4 L 99.104 2.4 L 99.104 7.648 L 103.712 7.648 L 103.712 10.144 L 99.104 10.144 L 99.104 18.176 A 6.936 6.936 0 0 0 99.133 18.832 Q 99.182 19.344 99.312 19.744 Q 99.52 20.384 99.872 20.768 Q 100.224 21.152 100.72 21.328 Q 101.216 21.504 101.76 21.504 Q 102.56 21.504 103.264 21.248 Q 103.968 20.992 104.608 20.64 L 105.408 22.944 Q 104.768 23.328 103.68 23.696 Q 102.592 24.064 101.408 24.064 Q 99.008 24.064 97.616 22.496 Q 96.473 21.208 96.268 18.97 A 11.212 11.212 0 0 1 96.224 17.952 L 96.224 10.144 L 93.344 10.144 L 93.344 7.648 L 96.288 7.648 Z M 110.848 0 L 110.848 18.176 A 6.606 6.606 0 0 0 110.908 19.1 Q 111.056 20.145 111.568 20.736 A 2.356 2.356 0 0 0 113.035 21.528 A 3.432 3.432 0 0 0 113.568 21.568 Q 114.176 21.568 114.752 21.424 Q 115.328 21.28 115.776 21.088 L 116.48 23.424 A 5.808 5.808 0 0 1 115.967 23.621 Q 115.712 23.707 115.42 23.783 A 11.193 11.193 0 0 1 115.056 23.872 A 7.621 7.621 0 0 1 114.046 24.027 A 9.764 9.764 0 0 1 113.184 24.064 A 6.854 6.854 0 0 1 111.869 23.942 A 5.779 5.779 0 0 1 111.12 23.744 Q 110.176 23.424 109.472 22.752 Q 108.768 22.08 108.368 21.024 A 5.725 5.725 0 0 1 108.088 19.975 Q 107.968 19.287 107.968 18.464 L 107.968 0 L 110.848 0 Z M 90.464 7.04 L 90.464 23.68 L 87.584 23.68 L 87.584 7.04 L 90.464 7.04 Z M 120.512 14.208 L 129.632 14.208 Q 129.632 12.442 128.991 11.266 A 3.975 3.975 0 0 0 128.416 10.464 A 3.996 3.996 0 0 0 126.189 9.256 A 5.886 5.886 0 0 0 125.056 9.152 A 4.54 4.54 0 0 0 123.536 9.397 A 3.91 3.91 0 0 0 121.968 10.432 A 4.716 4.716 0 0 0 121.074 11.842 Q 120.652 12.843 120.512 14.208 Z M 87.619 3.618 A 1.939 1.939 0 0 0 89.024 4.192 A 2.644 2.644 0 0 0 89.554 4.141 A 1.812 1.812 0 0 0 90.496 3.648 A 1.788 1.788 0 0 0 90.967 2.806 A 2.556 2.556 0 0 0 91.04 2.176 A 2.325 2.325 0 0 0 91.04 2.15 A 1.939 1.939 0 0 0 90.448 0.752 A 2.366 2.366 0 0 0 90.429 0.734 A 1.939 1.939 0 0 0 89.024 0.16 A 2.644 2.644 0 0 0 88.494 0.211 A 1.812 1.812 0 0 0 87.552 0.704 A 1.788 1.788 0 0 0 87.081 1.546 A 2.556 2.556 0 0 0 87.008 2.176 A 2.325 2.325 0 0 0 87.008 2.202 A 1.939 1.939 0 0 0 87.6 3.6 A 2.366 2.366 0 0 0 87.619 3.618 Z" vector-effect="non-scaling-stroke" stroke-width="1" stroke="#000000" fill="transparent" stroke-dasharray="764.470458984375" stroke-dashoffset="0%" fill-opacity="100%"/></g><title>SVG Title 1</title><desc>SVG Title 1</desc></svg>'));
	$svgt->save();
}
